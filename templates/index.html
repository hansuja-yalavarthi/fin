<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}"/>
    <title>Financial Tracker</title>
</head>
<body class="financial-tracker-body">
    <header class="financial-tracker-header">
        <nav class="navbar">
            <ul class="nav-links">
                <li>Home</li>
                <li>Add Transaction</li>
                <li>View Transactions</li>
                <li>Settings</li>
            </ul>
        </nav>

        <div class="balance-container">
            <div class="balance-item">
                <h4>Current Balance</h4>
                <p class="income">${{ balance }}</p>
            </div>
            <div class="balance-item">
                <h4>Income</h4>
                <p class="income">${{ income }}</p>
            </div>
            <div class="balance-item">
                <h4>Expenses</h4>
                <p class="expense">${{ expense }}</p>
            </div>
        </div>
    </header>

    <main class="main-container">
        <section class="sidebar">
            <div class="transaction-header">
                <h2>Transactions</h2>
                <a onclick="toggleForm()" id="add-transaction-btn" class="add-transaction-link">+</a>
            </div>
            <ul class="transaction-list">
                {% for transaction in transactions %}
                <li class="transaction-item" onclick="toggleDetails('{{ transaction[0] }}')">
                    <div>{{ transaction[1] }}</div>  
                    <div>${{ transaction[3] }}</div>  
                </li>
                {% endfor %}
            </ul>
        </section>

        <section class="transaction-details">
            <div id="transaction-detail" class="transaction-detail">
                <p>Click on a transaction to see the details here.</p>
            </div>
        </section>
    </main>

    
    <div id="addTransactionForm" class="popup-form">
        <div class="popup-form-content">
            <h2>Add New Transaction</h2>
            <form action="{{ url_for('add_transaction') }}" method="POST" class="transaction-form">
                <div class="form-group">
                    <label for="type">Type:</label>
                    <select id="type" name="type" required>
                        <option value="income">Income</option>
                        <option value="expense">Expense</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="category">Category:</label>
                    <input type="text" id="category" name="category" placeholder="e.g., Salary, Food" required>
                </div>
                <div class="form-group">
                    <label for="amount">Amount:</label>
                    <input type="number" id="amount" name="amount" step="0.01" placeholder="Enter amount" required>
                </div>
                <div class="form-group">
                    <label for="date">Date:</label>
                    <input type="date" id="date" name="date" required>
                </div>
                <div class="form-group">
                    <label for="description">Description:</label>
                    <textarea id="description" name="description" placeholder="Optional note"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit">Add Transaction</button>
                    <button type="button" onclick="toggleForm()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function toggleDetails(transactionId) {
            console.log("Transaction ID passed: ", transactionId);
            transactionId = Number(transactionId);
            if (isNaN(transactionId)) {
                console.error("Invalid Transaction ID");
                return;
            }
            fetch(`/transaction/${transactionId}`)
                .then(response => response.json())
                .then(data => {
                    const detailsSection = document.getElementById('transaction-detail');
                    detailsSection.innerHTML = `
                        <h3>Transaction Details</h3>
                        <p><strong>Type:</strong> ${data.type}</p>
                        <p><strong>Category:</strong> ${data.category}</p>
                        <p><strong>Date:</strong> ${data.date}</p>
                        <p><strong>Description:</strong> ${data.description}</p>
                        <button class="delete-transaction-link" onclick="deleteTransaction(${data.id})">Delete Transaction</button>
                    `;
                })
                .catch(error => {
                    console.error('Error fetching transaction details:', error);
                });
        }

        function deleteTransaction(transactionId) {
            console.log(`Deleting transaction with ID: ${transactionId}`);
            const confirmation = confirm("Are you sure you want to delete this transaction?");
            if (confirmation) {
                fetch(`/delete/${transactionId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        //alert("Transaction deleted successfully!");
                        window.location.reload();
                    } else {
                        //alert("Error deleting transaction");
                    }
                })
                .catch(error => {
                    console.error('Error deleting transaction:', error);
                    alert("Error deleting transaction");
                });
            }
        }
    // Function to open the popup
    function openPopup() {
        document.getElementById('add-transaction-popup').style.display = 'flex';
    }

    // Function to close the popup
    function closePopup() {
        document.getElementById('add-transaction-popup').style.display = 'none';
    }

    // Show popup when the "Add Transaction" button is clicked
    document.getElementById('add-transaction-btn').onclick = openPopup;

    // Remove the 'onsubmit' handler if you want to perform normal form submission
    document.getElementById('add-transaction-form').onsubmit = function(event) {
        // Normal form submission, no need to prevent it
        closePopup(); // Close the popup after submitting
    }

    </script>

<script>
    // Function to open the popup form
    function toggleForm() {
        const formPopup = document.getElementById('addTransactionForm');
        formPopup.style.display = formPopup.style.display === 'flex' ? 'none' : 'flex';
    }

    // Function to close the popup form (used when submitting the form)
    function closeForm() {
        const formPopup = document.getElementById('addTransactionForm');
        formPopup.style.display = 'none';
    }

    // Event listener for the "Add Transaction" button (the "+" sign)
    document.getElementById('add-transaction-btn').addEventListener('click', function() {
        toggleForm();  // Open the form when the "+" button is clicked
    });

    // Optional: Automatically close the form when the user submits it
    document.querySelector('.transaction-form').addEventListener('submit', function() {
        closeForm();  // Close form after submit
    });
</script>



</body>
</html>

<!--<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}"/>
    <title>Financial Tracker</title>
</head>
<body class="financial-tracker-body">
    <header class="financial-tracker-header">
        <nav class="navbar">
            <ul class="nav-links">
                <li>Home</li>
                <li>Add Transaction</li>
                <li>View Transactions</li>
                <li>Settings</li>
            </ul>
        </nav>

        <div class="balance-container">
            <div class="balance-item">
                <h4>Current Balance</h4>
                <p class="income">${{ balance }}</p>
            </div>
            <div class="balance-item">
                <h4>Income</h4>
                <p class="income">+${{ income }}</p>
            </div>
            <div class="balance-item">
                <h4>Expenses</h4>
                <p class="expense">-${{ expense }}</p>
            </div>
        </div>
    </header>

    <main class="main-container">
        <section class="sidebar">
            <div class="transaction-header">
                <h2>Transactions</h2>
                <a onclick="toggleForm()" id="add-transaction-btn" class="add-transaction-link">+</a>
            </div>
            <ul class="transaction-list">
                {% for transaction in transactions %}
                <li class="transaction-item" onclick="toggleDetails('{{ transaction[0] }}')">
                    <div>{{ transaction[1] }}</div>  
                    <div>${{ transaction[3] }}</div>  
                </li>
                {% endfor %}
            </ul>
        </section>

        <section class="transaction-details">
            <div id="transaction-detail" class="transaction-detail">
                <p>Click on a transaction to see the details here.</p>
            </div>
        </section>
    </main>

    <div id="addTransactionForm" class="popup-form">
        <div class="popup-form-content">
            <h2>Add New Transaction</h2>
            <form action="{{ url_for('add_transaction') }}" method="POST" class="transaction-form">
                <div class="form-group">
                    <label for="type">Type:</label>
                    <select id="type" name="type" required>
                        <option value="income">Income</option>
                        <option value="expense">Expense</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="category">Category:</label>
                    <input type="text" id="category" name="category" placeholder="e.g., Salary, Food" required>
                </div>
                <div class="form-group">
                    <label for="amount">Amount:</label>
                    <input type="number" id="amount" name="amount" step="0.01" placeholder="Enter amount" required>
                </div>
                <div class="form-group">
                    <label for="date">Date:</label>
                    <input type="date" id="date" name="date" required>
                </div>
                <div class="form-group">
                    <label for="description">Description:</label>
                    <textarea id="description" name="description" placeholder="Optional note"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit">Add Transaction</button>
                    <button type="button" onclick="toggleForm()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function toggleForm() {
            const form = document.getElementById("addTransactionForm");
            form.style.display = form.style.display === "flex" ? "none" : "flex";
        }

        function toggleDetails(id) {
            const detail = document.getElementById("transaction-detail");
            // Fetch and display transaction details dynamically if needed
            detail.innerHTML = `Transaction details for ID: ${id}`;
        }
    </script>
</body>
</html>
-->
